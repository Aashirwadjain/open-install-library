---
- debug:
    msg: Install MySQL

- name: Install MySQL extras
  apt:
    name: ['default-mysql-server']
    update_cache: yes
    state: latest
  become: yes

- name: Create Database
  shell: 'mysql -e "CREATE DATABASE IF NOT EXISTS MySQLSample;'
  become: yes

- name: Create User
  shell: 'mysql -e "CREATE USER 'newrelic'@'localhost' IDENTIFIED BY \ 'testpwd';"'
  become: yes

- name: Modify User
  shell: 'mysql -e "GRANT REPLICATION CLIENT ON *.* TO 'newrelic'@'localhost' WITH MAX_USER_CONNECTIONS 5;"'

- name: Export Variables
  shell: "export HOSTNAME=localhost USERNAME=newrelic PASSWORD=testpwd DB_PORT=3306"

- name: Check MySQL status
  shell: "service mysql start"
  become: yes
