---
- debug:
    msg: Install MySQL


- name: Add MySQL Repository
  shell: "yum install https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm"
  become: yes

- name: Install epel
  shell: "amazon-linux-extras install epel -y"
  become: yes

- name: Install the MySQL
  shell: "yum install mysql-community-server -y"
  become: yes

- name: Start mysql service
  shell: "service mysqld start"

- name: Check if default DB exists
  shell: mysql -e 'SHOW DATABASES;' | grep 'mysql'
  register: dbstatus
  failed_when: dbstatus.rc == 1 ## fail when no such database exists

- name: Restart MySQL
  shell: "systemctl restart mysqld"
  become: yes

