---
- debug:
    msg: Install MySQL

- name: Download MySQL SUSE repository
  shell: "wget https://dev.mysql.com/get/mysql80-community-release-sles12-3.noarch.rpm"
  become: yes

- name: Install MySQL SUSE repository
  shell: "rpm -ivh mysql80-community-release-sles12-3.noarch.rpm"
  become: yes

- name: Import GPG key for MySQL SUSE repository
  shell: "rpm --import /etc/RPM-GPG-KEY-mysql"
  become: yes

- name: Refresh zypper repository information
  shell: "zypper refresh"
  become: yes

- name: Install MySQL
  shell: "zypper -n install mysql-community-server"
  become: yes

- name: Enable MySQL service
  shell: "/sbin/chkconfig --add mysql"
  
- name: Check if default DB exists
  shell: "mysql -e 'SHOW DATABASES;' | grep 'mysql'"
  register: dbstatus
  failed_when: dbstatus.rc == 1 ## fail when no such database exists

- name: Restart MySQL
  shell: "systemctl restart mysqld"
  become: yes
