---
- debug:
    msg: Install ElasticSearch

- name: Get latest packages info
  shell: "apt update -y"
  become: true

- name: Install needed dependencies
  shell: "apt -y install gnupg2 apt-transport-https wget"
  become: true

- name: Import ElasticSearch GPG Key
  shell: "wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -"
  become: true

- name: Add Elasticsearch APT repository
  shell: sh -c 'echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" > /etc/apt/sources.list.d/elastic-7.x.list'
  become: true

- name: Refresh packages
  shell: "apt update -y"
  become: true

- name: Install ElasticSearch
  shell: "apt install elasticsearch -y"
  become: true

- name: Restart systemd service daemon
  shell: "systemctl daemon-reload"
  become: true

- name: Add user to elasticsearch
  shell: "/usr/share/elasticsearch/bin/elasticsearch-users useradd testuser -p testpassword -r superuser"
  become: true

- name: Restart ElasticSearch
  shell: "systemctl enable elasticsearch && systemctl restart elasticsearch"
  become: yes
