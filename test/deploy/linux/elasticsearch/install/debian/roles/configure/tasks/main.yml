---
- debug:
    msg: Install ElasticSearch

- name: Get latest packages info
  shell: "apt update"
  become: true

- name: Install needed dependencies
  shell: "apt -y install gnupg2 apt-transport-https wget"
  become: true

- name: Import ElasticSearch GPG Key
  shell: "wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -"
  become: true

- name: Add Elasticsearch APT repository
  command: |
    echo "deb https://artifacts.elastic.co/packages/oss-7.x/apt stable main" | tee  /etc/apt/sources.list.d/elastic-7.x.list
  become: true

- name: Refresh packages
  shell: "apt update -y"
  become: true

- name: Install ElasticSearch
  shell: "apt install elasticsearch-oss -y"
  become: true

- name: Restart ElasticSearch
  shell: "systemctl enable elasticsearch.service && systemctl restart elasticsearch.service"
  become: yes
